"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[76],{1339:(C,v,d)=>{d.d(v,{u:()=>P});var m=d(467),b=d(4412),i=d(375),l=d(3703),x=d(9758);let P=(()=>{class g{constructor(r,t){this.supabase=r,this.router=t,this.currentUserSubject=new b.t(null),this.currentUser$=this.currentUserSubject.asObservable(),this.checkSession()}checkSession(){var r=this;return(0,m.A)(function*(){const{data:{user:t}}=yield r.supabase.auth.getUser();r.currentUserSubject.next(t)})()}login(r){var t=this;return(0,m.A)(function*(){try{console.log("\u{1f510} Intentando login con:",r.email);const{data:o,error:c}=yield t.supabase.auth.signInWithPassword({email:r.email,password:r.password});if(c)throw console.error("\u274c Error en signInWithPassword:",c),c;console.log("\u2705 Autenticaci\xf3n exitosa, user_id:",o.user.id),console.log("\u{1f50d} Buscando en tabla administradores...");const{data:_,error:f}=yield t.supabase.from("administradores").select("*").eq("user_id",o.user.id).maybeSingle();if(console.log("\u{1f4ca} Admin encontrado:",_),console.log("\u26a0\ufe0f Error admin (si hay):",f),_)return console.log("\u2705 Usuario es ADMINISTRADOR"),t.currentUserSubject.next(o.user),{success:!0,user:o.user,profile:{..._,rol:"administrador"}};console.log("\u{1f50d} Buscando en tabla docentes...");const{data:h,error:u}=yield t.supabase.from("docentes").select("*").eq("user_id",o.user.id).maybeSingle();if(console.log("\u{1f4ca} Docente encontrado:",h),console.log("\u26a0\ufe0f Error docente (si hay):",u),h)return console.log("\u2705 Usuario es DOCENTE"),t.currentUserSubject.next(o.user),{success:!0,user:o.user,profile:{...h,rol:"docente"}};throw console.error("\u274c Usuario NO encontrado en administradores ni docentes"),new Error("Usuario no encontrado en el sistema")}catch(o){return console.error("\u274c Error en login:",o),o.message.includes("Invalid login credentials")?{success:!1,error:"Correo o contrase\xf1a incorrectos. Verifica tus datos."}:o.message.includes("Email not confirmed")?{success:!1,error:"Debes confirmar tu correo electr\xf3nico antes de iniciar sesi\xf3n."}:{success:!1,error:o.message||"Error al iniciar sesi\xf3n"}}})()}register(r){var t=this;return(0,m.A)(function*(){try{const{data:o,error:c}=yield t.supabase.auth.signUp({email:r.email,password:r.password});if(c)throw c;if(!o.user)throw new Error("No se pudo crear el usuario");const{data:_,error:f}=yield t.supabase.from("docentes").insert([{user_id:o.user.id,email:r.email,nombres:r.nombres,apellidos:r.apellidos,telefono:r.telefono||null,entidad:r.entidad||null,programa:r.programa||null,area:r.area||null,foto_url:r.foto_url||null}]).select().single();if(f)throw f;return{success:!0,user:o.user,docente:_}}catch(o){return console.error("Error en registro:",o),{success:!1,error:o.message||"Error al crear la cuenta"}}})()}forgotPassword(r){var t=this;return(0,m.A)(function*(){try{const{data:o}=yield t.supabase.from("docentes").select("email, nombres, apellidos").eq("email",r).maybeSingle(),{data:c}=yield t.supabase.from("administradores").select("email, nombres, apellidos").eq("email",r).maybeSingle();if(!o&&!c)return{success:!1,error:"El correo electr\xf3nico no est\xe1 registrado en el sistema"};const _=`${window.location.origin}/auth/reset-password`;console.log("\u{1f517} Redirect URL:",_);const{error:f}=yield t.supabase.auth.resetPasswordForEmail(r,{redirectTo:_});if(f){if(f.message.includes("User not found"))return{success:!1,error:"No se encontr\xf3 una cuenta asociada a este correo"};throw f}return{success:!0,message:`Se ha enviado un correo de recuperaci\xf3n a ${r}. Revisa tu bandeja de entrada.`,profile:o||c}}catch(o){return console.error("Error en recuperaci\xf3n de contrase\xf1a:",o),o.message.includes("Email not confirmed")?{success:!1,error:"Debes confirmar tu correo electr\xf3nico antes de restablecer la contrase\xf1a"}:o.message.includes("rate limit")?{success:!1,error:"Demasiados intentos. Por favor espera unos minutos e intenta de nuevo"}:{success:!1,error:o.message||"Error al enviar el correo de recuperaci\xf3n"}}})()}updatePassword(r){var t=this;return(0,m.A)(function*(){try{const{error:o}=yield t.supabase.auth.updateUser({password:r});if(o)throw o;return{success:!0,message:"Contrase\xf1a actualizada exitosamente"}}catch(o){return console.error("Error actualizando contrase\xf1a:",o),{success:!1,error:o.message||"Error al actualizar la contrase\xf1a"}}})()}logout(){var r=this;return(0,m.A)(function*(){yield r.supabase.auth.signOut(),r.currentUserSubject.next(null),r.router.navigate(["/auth/login"])})()}getDocenteByUserId(r){var t=this;return(0,m.A)(function*(){const{data:o,error:c}=yield t.supabase.from("docentes").select("*").eq("user_id",r).single();return c?(console.error("Error obteniendo docente:",c),null):o})()}getAdminByUserId(r){var t=this;return(0,m.A)(function*(){const{data:o,error:c}=yield t.supabase.from("administradores").select("*").eq("user_id",r).single();return c?(console.error("Error obteniendo administrador:",c),null):o})()}checkEmailExists(r){var t=this;return(0,m.A)(function*(){const{data:o}=yield t.supabase.from("docentes").select("email").eq("email",r).single(),{data:c}=yield t.supabase.from("administradores").select("email").eq("email",r).single();return!(!o&&!c)})()}static{this.\u0275fac=function(t){return new(t||g)(i.KVO(l.w),i.KVO(x.Ix))}}static{this.\u0275prov=i.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},8536:(C,v,d)=>{d.d(v,{EditarPage:()=>h});var m=d(467),b=d(9769),i=d(5206),l=d(8370),x=d(2951),P=d(5873),g=d(375),e=d(5547),r=d(9758),t=d(3703);function o(u,E){1&u&&(e.j41(0,"div",11),e.nrm(1,"ion-spinner",12),e.j41(2,"p"),e.EFF(3,"Cargando informaci\xf3n..."),e.k0s()())}function c(u,E){1&u&&e.nrm(0,"ion-icon",40)}function _(u,E){if(1&u){const n=e.RV6();e.j41(0,"div",38),e.bIt("click",function(){const a=g.eBV(n).$implicit,p=e.XpG(2);return g.Njj(p.asignaturaForm.patchValue({color:a.value}))}),e.DNE(1,c,1,0,"ion-icon",39),e.k0s()}if(2&u){let n,s;const a=E.$implicit,p=e.XpG(2);e.xc7("background",a.value),e.AVh("selected",(null==(n=p.asignaturaForm.get("color"))?null:n.value)===a.value),e.R7$(),e.Y8G("ngIf",(null==(s=p.asignaturaForm.get("color"))?null:s.value)===a.value)}}function f(u,E){if(1&u){const n=e.RV6();e.j41(0,"div")(1,"ion-card",13)(2,"ion-card-content")(3,"form",14)(4,"div",15)(5,"ion-label",16),e.EFF(6," Nombre de la asignatura "),e.j41(7,"span",17),e.EFF(8,"*"),e.k0s()(),e.j41(9,"ion-item",18),e.nrm(10,"ion-input",19),e.k0s()(),e.j41(11,"div",20)(12,"div",15)(13,"ion-label",16),e.EFF(14," C\xf3digo "),e.j41(15,"span",17),e.EFF(16,"*"),e.k0s()(),e.j41(17,"ion-item",18),e.nrm(18,"ion-input",21),e.k0s()(),e.j41(19,"div",15)(20,"ion-label",16),e.EFF(21," Grupo "),e.j41(22,"span",17),e.EFF(23,"*"),e.k0s()(),e.j41(24,"ion-item",18),e.nrm(25,"ion-input",22),e.k0s()()(),e.j41(26,"div",20)(27,"div",15)(28,"ion-label",16),e.EFF(29,"Facultad"),e.k0s(),e.j41(30,"ion-item",18),e.nrm(31,"ion-input",23),e.k0s()(),e.j41(32,"div",15)(33,"ion-label",16),e.EFF(34,"Programa"),e.k0s(),e.j41(35,"ion-item",18),e.nrm(36,"ion-input",24),e.k0s()()(),e.j41(37,"div",20)(38,"div",15)(39,"ion-label",16),e.EFF(40," Nivel "),e.j41(41,"span",17),e.EFF(42,"*"),e.k0s()(),e.j41(43,"ion-item",18),e.nrm(44,"ion-input",25),e.k0s()(),e.j41(45,"div",15)(46,"ion-label",16),e.EFF(47," Periodo "),e.j41(48,"span",17),e.EFF(49,"*"),e.k0s()(),e.j41(50,"ion-item",18),e.nrm(51,"ion-input",26),e.k0s()()(),e.j41(52,"div",20)(53,"div",15)(54,"ion-label",16),e.EFF(55,"Localidad"),e.k0s(),e.j41(56,"ion-item",18),e.nrm(57,"ion-input",27),e.k0s()(),e.j41(58,"div",15)(59,"ion-label",16),e.EFF(60," Cr\xe9ditos "),e.j41(61,"span",17),e.EFF(62,"*"),e.k0s()(),e.j41(63,"ion-item",18),e.nrm(64,"ion-input",28),e.k0s()()(),e.j41(65,"div",20)(66,"div",15)(67,"ion-label",16),e.EFF(68," Modalidad "),e.j41(69,"span",17),e.EFF(70,"*"),e.k0s()(),e.j41(71,"ion-item",18)(72,"ion-select",29)(73,"ion-select-option",30),e.EFF(74,"Presencial"),e.k0s(),e.j41(75,"ion-select-option",31),e.EFF(76,"Virtual"),e.k0s(),e.j41(77,"ion-select-option",32),e.EFF(78,"H\xedbrida"),e.k0s()()()(),e.j41(79,"div",15)(80,"ion-label",16),e.EFF(81,"Aula"),e.k0s(),e.j41(82,"ion-item",18),e.nrm(83,"ion-input",33),e.k0s()()(),e.j41(84,"div",15)(85,"ion-label",16),e.EFF(86," Color de identificaci\xf3n "),e.j41(87,"span",17),e.EFF(88,"*"),e.k0s()(),e.j41(89,"div",34),e.DNE(90,_,2,5,"div",35),e.k0s()()()()(),e.j41(91,"ion-button",36),e.bIt("click",function(){g.eBV(n);const a=e.XpG();return g.Njj(a.guardar())}),e.nrm(92,"ion-icon",37),e.EFF(93," Guardar Cambios "),e.k0s()()}if(2&u){const n=e.XpG();e.R7$(3),e.Y8G("formGroup",n.asignaturaForm),e.R7$(87),e.Y8G("ngForOf",n.colores),e.R7$(),e.Y8G("disabled",n.asignaturaForm.invalid)}}let h=(()=>{class u{constructor(n,s,a,p,O,F){this.route=n,this.router=s,this.formBuilder=a,this.supabase=p,this.loadingController=O,this.toastController=F,this.asignaturaId="",this.loading=!0,this.colores=[{value:"#3b82f6",label:"Azul"},{value:"#10b981",label:"Verde"},{value:"#f59e0b",label:"Naranja"},{value:"#ef4444",label:"Rojo"},{value:"#8b5cf6",label:"P\xfarpura"},{value:"#ec4899",label:"Rosa"},{value:"#06b6d4",label:"Cyan"},{value:"#84cc16",label:"Lima"}],(0,x.d)({saveOutline:P.oc8})}ngOnInit(){var n=this;return(0,m.A)(function*(){n.asignaturaId=n.route.snapshot.paramMap.get("id")||"",n.asignaturaId?(n.initForm(),yield n.loadAsignatura()):n.router.navigate(["/home"])})()}initForm(){this.asignaturaForm=this.formBuilder.group({nombre:["",[i.k0.required,i.k0.minLength(3)]],codigo:["",[i.k0.required,i.k0.minLength(2)]],grupo:["",[i.k0.required]],nivel:["",[i.k0.required]],periodo:["",[i.k0.required]],creditos:[3,[i.k0.required,i.k0.min(1),i.k0.max(10)]],modalidad:["Presencial",[i.k0.required]],aula:[""],color:["#3b82f6",[i.k0.required]],facultad:[""],programa:[""],cds:[""]})}loadAsignatura(){var n=this;return(0,m.A)(function*(){n.loading=!0;try{const{data:s,error:a}=yield n.supabase.from("asignaturas").select("*").eq("id",n.asignaturaId).single();if(a)throw a;s&&n.asignaturaForm.patchValue(s)}catch(s){console.error("\u274c Error cargando asignatura:",s),yield n.showToast("Error al cargar la asignatura","danger"),n.router.navigate(["/home"])}finally{n.loading=!1}})()}guardar(){var n=this;return(0,m.A)(function*(){if(n.asignaturaForm.valid){const s=yield n.loadingController.create({message:"Guardando cambios...",spinner:"crescent"});yield s.present();try{const a=n.asignaturaForm.value,{error:p}=yield n.supabase.from("asignaturas").update({...a,updated_at:(new Date).toISOString()}).eq("id",n.asignaturaId);if(yield s.dismiss(),p)throw p;yield n.showToast("\u2713 Asignatura actualizada exitosamente","success"),n.router.navigate(["/asignaturas/detalle",n.asignaturaId])}catch(a){yield s.dismiss(),console.error("\u274c Error guardando:",a),yield n.showToast("Error al guardar los cambios","danger")}}})()}showToast(n,s){var a=this;return(0,m.A)(function*(){yield(yield a.toastController.create({message:n,duration:3e3,position:"top",color:s})).present()})()}static{this.\u0275fac=function(s){return new(s||u)(e.rXU(r.nX),e.rXU(r.Ix),e.rXU(i.ok),e.rXU(t.w),e.rXU(l.Xi),e.rXU(l.K_))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["app-editar"]],decls:13,vars:6,consts:[[3,"translucent"],["color","primary"],["slot","start"],[3,"defaultHref"],["slot","end"],[3,"click","disabled"],["name","save-outline"],[3,"fullscreen"],[1,"editar-container"],["class","loading-state",4,"ngIf"],[4,"ngIf"],[1,"loading-state"],["name","crescent","color","primary"],[1,"form-card"],[3,"formGroup"],[1,"input-group"],[1,"input-label"],[1,"required"],["lines","none",1,"custom-item"],["type","text","formControlName","nombre","placeholder","Ej: C\xe1lculo Diferencial",1,"custom-input"],[1,"input-row"],["type","text","formControlName","codigo","placeholder","Ej: MAT101",1,"custom-input"],["type","text","formControlName","grupo","placeholder","Ej: A",1,"custom-input"],["type","text","formControlName","facultad","placeholder","Ej: Ingenier\xeda",1,"custom-input"],["type","text","formControlName","programa","placeholder","Ej: Sistemas",1,"custom-input"],["type","text","formControlName","nivel","placeholder","Ej: 5",1,"custom-input"],["type","text","formControlName","periodo","placeholder","Ej: 2025-1",1,"custom-input"],["type","text","formControlName","cds","placeholder","Ej: Quibd\xf3",1,"custom-input"],["type","number","formControlName","creditos","min","1","max","10",1,"custom-input"],["formControlName","modalidad","interface","action-sheet",1,"custom-select"],["value","Presencial"],["value","Virtual"],["value","H\xedbrida"],["type","text","formControlName","aula","placeholder","Ej: Lab 101",1,"custom-input"],[1,"color-selector"],["class","color-option",3,"selected","background","click",4,"ngFor","ngForOf"],["expand","block",1,"save-button",3,"click","disabled"],["name","save-outline","slot","start"],[1,"color-option",3,"click"],["name","checkmark-circle",4,"ngIf"],["name","checkmark-circle"]],template:function(s,a){1&s&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Editar Asignatura"),e.k0s(),e.j41(6,"ion-buttons",4)(7,"ion-button",5),e.bIt("click",function(){return a.guardar()}),e.nrm(8,"ion-icon",6),e.k0s()()()(),e.j41(9,"ion-content",7)(10,"div",8),e.DNE(11,o,4,0,"div",9)(12,f,94,3,"div",10),e.k0s()()),2&s&&(e.Y8G("translucent",!0),e.R7$(3),e.Y8G("defaultHref","/asignaturas/detalle/"+a.asignaturaId),e.R7$(4),e.Y8G("disabled",a.asignaturaForm.invalid||a.loading),e.R7$(2),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngIf",a.loading),e.R7$(),e.Y8G("ngIf",!a.loading))},dependencies:[b.MD,b.Sq,b.bT,i.YN,i.qT,i.BC,i.cb,i.X1,i.j4,i.JD,l.eU,l.ai,l.BC,l.QW,l.el,l.Jm,l.iq,l.W9,l.b_,l.I9,l.uz,l.he,l.$w,l.Nm,l.Ip,l.w2],styles:["ion-content[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 25%, #f8fafc 50%, #ffffff 100%)}.editar-container[_ngcontent-%COMP%]{padding:20px 20px 40px;max-width:800px;margin:0 auto}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 20px}.loading-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:56px;height:56px;margin-bottom:20px}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#64748b;font-weight:500}.form-card[_ngcontent-%COMP%]{border-radius:20px;box-shadow:0 4px 20px #00000014;border:1px solid rgba(226,232,240,.8);margin-bottom:20px;animation:_ngcontent-%COMP%_fadeInUp .6s ease-out}.form-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:24px}.input-group[_ngcontent-%COMP%]{margin-bottom:20px;flex:1}.input-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.input-label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#334155;margin-bottom:8px}.input-label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#ef4444}.custom-item[_ngcontent-%COMP%]{--background: #f8fafc;--border-radius: 12px;--padding-start: 16px;--padding-end: 16px;border:2px solid #e2e8f0;border-radius:12px;transition:all .3s ease}.custom-item.ion-focused[_ngcontent-%COMP%]{--background: white;border-color:#3b82f6;box-shadow:0 0 0 4px #3b82f61a}.custom-input[_ngcontent-%COMP%], .custom-select[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:#1e293b}.color-selector[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}.color-option[_ngcontent-%COMP%]{aspect-ratio:1;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;border:3px solid transparent;transition:all .3s ease;box-shadow:0 2px 8px #0000001a}.color-option[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #00000026}.color-option.selected[_ngcontent-%COMP%]{border-color:#fff;box-shadow:0 0 0 3px currentColor,0 4px 12px #0003}.color-option[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px;color:#fff;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.save-button[_ngcontent-%COMP%]{--border-radius: 12px;height:52px;font-weight:600;text-transform:none;font-size:16px;box-shadow:0 4px 16px #3b82f64d;margin-top:20px}.save-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media(max-width:768px){.editar-container[_ngcontent-%COMP%]{padding:16px}.input-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:20px}}"]})}}return u})()}}]);