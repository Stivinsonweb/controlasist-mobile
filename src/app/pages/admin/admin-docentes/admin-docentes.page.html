<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div class="header-title">
        <ion-icon name="people-outline"></ion-icon>
        Docentes Registrados
      </div>
    </ion-title>
    <ion-button slot="end" fill="clear" (click)="handleRefresh()">
      <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="refresh-outline" pullingText="Desliza para actualizar"
      refreshingSpinner="crescent" refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="docentes-container">

    <!-- Header Info -->
    <div class="info-section">
      <ion-badge color="medium" class="readonly-badge">
        <ion-icon name="eye-outline"></ion-icon>
        Solo lectura
      </ion-badge>
      <h2 class="page-subtitle">Visualización de docentes del sistema</h2>
    </div>

    <!-- Estadísticas -->
    <ion-card class="stats-card">
      <ion-card-content>
        <div class="stat-item">
          <ion-icon name="people" color="primary"></ion-icon>
          <div class="stat-info">
            <h3>{{ docentes.length }}</h3>
            <p>Total de docentes</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Gráficas y Filtros -->
    <div class="charts-section">
      <div class="section-header">
        <h2 class="section-title">
          <ion-icon name="stats-chart-outline"></ion-icon>
          Estadísticas
        </h2>

        <!-- Filtro de Período -->
        <ion-segment [(ngModel)]="selectedPeriod" (ionChange)="onPeriodChange($event)" class="period-filter">
          <ion-segment-button value="day">
            <ion-label>Día</ion-label>
          </ion-segment-button>
          <ion-segment-button value="week">
            <ion-label>Semana</ion-label>
          </ion-segment-button>
          <ion-segment-button value="month">
            <ion-label>Mes</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>

      <!-- Gráfica de Tendencia -->
      <ion-card class="chart-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="trending-up-outline"></ion-icon>
            Registro de Docentes
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <canvas id="docentesChart"></canvas>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Gráfica por Entidad -->
      <ion-card class="chart-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="business-outline"></ion-icon>
            Docentes por Entidad
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <canvas id="entidadesChart"></canvas>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Buscador -->
    <div class="search-section" *ngIf="docentes.length > 0">
      <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="filterDocentes()"
        placeholder="Buscar por nombre, email o entidad..." animated="true" debounce="300">
      </ion-searchbar>
    </div>

    <!-- Loading Skeleton -->
    <div class="docentes-list" *ngIf="loading">
      <ion-card class="docente-card skeleton-card" *ngFor="let item of [1,2,3,4]">
        <ion-card-content>
          <div class="docente-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-info">
              <ion-skeleton-text [animated]="true"
                style="width: 60%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="true" style="width: 80%; height: 16px;"></ion-skeleton-text>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Sin docentes -->
    <div *ngIf="!loading && docentes.length === 0" class="empty-state">
      <div class="empty-icon-container">
        <ion-icon name="people-outline" class="empty-icon"></ion-icon>
      </div>
      <h3>No hay docentes registrados</h3>
      <p>Aún no se han registrado docentes en el sistema</p>
    </div>

    <!-- Sin resultados de búsqueda -->
    <div *ngIf="!loading && docentes.length > 0 && docentesFiltrados.length === 0" class="empty-state">
      <div class="empty-icon-container">
        <ion-icon name="search-outline" class="empty-icon"></ion-icon>
      </div>
      <h3>No se encontraron resultados</h3>
      <p>Intenta con otros términos de búsqueda</p>
    </div>

    <!-- Lista de docentes -->
    <div class="docentes-list" *ngIf="!loading && docentesFiltrados.length > 0">
      <ion-card class="docente-card" *ngFor="let docente of docentesFiltrados; let i = index"
        [style.animation-delay]="(i * 0.05) + 's'">
        <ion-card-content>
          <div class="docente-header">
            <ion-avatar class="docente-avatar">
              <img [src]="getAvatarUrl(docente)" [alt]="getNombreCompleto(docente)" />
            </ion-avatar>
            <div class="docente-info">
              <h3 class="docente-nombre">{{ getNombreCompleto(docente) }}</h3>
              <div class="docente-email">
                <ion-icon name="mail-outline"></ion-icon>
                {{ docente.email }}
              </div>
            </div>
          </div>

          <div class="docente-details" *ngIf="docente.telefono || docente.entidad || docente.programa || docente.area">
            <div class="detail-item" *ngIf="docente.telefono">
              <ion-icon name="call-outline" color="medium"></ion-icon>
              <span>{{ docente.telefono }}</span>
            </div>
            <div class="detail-item" *ngIf="docente.entidad">
              <ion-icon name="business-outline" color="medium"></ion-icon>
              <span>{{ docente.entidad }}</span>
            </div>
            <div class="detail-item" *ngIf="docente.programa">
              <ion-icon name="school-outline" color="medium"></ion-icon>
              <span>{{ docente.programa }}</span>
            </div>
            <div class="detail-item" *ngIf="docente.area">
              <ion-icon name="briefcase-outline" color="medium"></ion-icon>
              <span>{{ docente.area }}</span>
            </div>
          </div>

          <div class="docente-footer">
            <span class="created-date">
              <ion-icon name="calendar-outline"></ion-icon>
              Registrado: {{ formatDate(docente.created_at) }}
            </span>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

  </div>
</ion-content>