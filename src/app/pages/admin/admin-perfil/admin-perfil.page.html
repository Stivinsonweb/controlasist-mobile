<<<<<<< HEAD
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div style="display: flex; align-items: center; gap: 8px;">
        <ion-icon name="person-outline"></ion-icon>
        Mi Perfil
      </div>
    </ion-title>
    <ion-button slot="end" fill="clear" (click)="handleRefresh($event)">
      <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="refresh-outline" pullingText="Desliza para actualizar"
      refreshingSpinner="crescent" refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="content-container">
    <!-- Loading Skeleton -->
    <div *ngIf="loading" class="profile-skeleton">
      <ion-card>
        <ion-card-content>
          <div class="skeleton-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-info">
              <ion-skeleton-text [animated]="true" style="width: 60%; height: 24px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="true" style="width: 80%; height: 16px;"></ion-skeleton-text>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!loading && admin" class="profile-content">
      <!-- Profile Card -->
      <ion-card class="profile-card">
        <ion-card-content>
          <div class="profile-header">
            <ion-avatar class="profile-avatar">
              <img [src]="getAvatarUrl()" />
            </ion-avatar>
            <div class="profile-info">
              <h2>{{ getNombreCompleto() }}</h2>
              <ion-badge color="primary">
                <ion-icon name="shield-checkmark"></ion-icon>
                Administrador
              </ion-badge>
            </div>
          </div>

          <!-- View Mode -->
          <div *ngIf="!isEditMode" class="profile-details">
            <div class="detail-row">
              <div class="detail-label"><ion-icon name="mail-outline"></ion-icon> Correo electr√≥nico</div>
              <div class="detail-value">{{ admin.email }}</div>
            </div>
            <div class="detail-row" *ngIf="admin.telefono">
              <div class="detail-label"><ion-icon name="call-outline"></ion-icon> Tel√©fono</div>
              <div class="detail-value">{{ admin.telefono }}</div>
            </div>
            <div class="detail-row" *ngIf="admin.entidad">
              <div class="detail-label"><ion-icon name="business-outline"></ion-icon> Entidad</div>
              <div class="detail-value">{{ admin.entidad }}</div>
            </div>
            <div class="detail-row" *ngIf="admin.programa">
              <div class="detail-label"><ion-icon name="school-outline"></ion-icon> Programa</div>
              <div class="detail-value">{{ admin.programa }}</div>
            </div>
            <div class="detail-row" *ngIf="admin.area">
              <div class="detail-label"><ion-icon name="briefcase-outline"></ion-icon> √Årea</div>
              <div class="detail-value">{{ admin.area }}</div>
            </div>
          </div>

          <!-- Edit Mode -->
          <form *ngIf="isEditMode" [formGroup]="profileForm" class="edit-form">
            <ion-item>
              <ion-label position="stacked">Nombres *</ion-label>
              <ion-input formControlName="nombres" placeholder="Ingresa tus nombres"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Apellidos *</ion-label>
              <ion-input formControlName="apellidos" placeholder="Ingresa tus apellidos"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Tel√©fono</ion-label>
              <ion-input formControlName="telefono" type="tel" placeholder="Ingresa tu tel√©fono"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Entidad</ion-label>
              <ion-input formControlName="entidad" placeholder="Ingresa tu entidad"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Programa</ion-label>
              <ion-input formControlName="programa" placeholder="Ingresa tu programa"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">√Årea</ion-label>
              <ion-input formControlName="area" placeholder="Ingresa tu √°rea"></ion-input>
            </ion-item>
          </form>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <ion-button *ngIf="!isEditMode" expand="block" (click)="toggleEditMode()">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              Editar Perfil
            </ion-button>

            <div *ngIf="isEditMode" class="edit-buttons">
              <ion-button expand="block" color="success" (click)="saveProfile()" [disabled]="profileForm.invalid">
                <ion-icon name="save-outline" slot="start"></ion-icon>
                Guardar Cambios
              </ion-button>
              <ion-button expand="block" color="medium" fill="outline" (click)="toggleEditMode()">
                <ion-icon name="close-outline" slot="start"></ion-icon>
                Cancelar
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Change Password Card -->
      <ion-card class="password-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="key-outline"></ion-icon>
            Cambiar Contrase√±a
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div *ngIf="!isChangingPassword">
            <p class="password-info">Actualiza tu contrase√±a para mantener tu cuenta segura.</p>
            <ion-button expand="block" fill="outline" (click)="togglePasswordChange()">
              <ion-icon name="key-outline" slot="start"></ion-icon>
              Cambiar Contrase√±a
            </ion-button>
          </div>

          <form *ngIf="isChangingPassword" [formGroup]="passwordForm" class="password-form">
            <ion-item>
              <ion-label position="stacked">Contrase√±a Actual *</ion-label>
              <ion-input formControlName="currentPassword" type="password" placeholder="Ingresa tu contrase√±a actual">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Nueva Contrase√±a *</ion-label>
              <ion-input formControlName="newPassword" type="password" placeholder="Ingresa tu nueva contrase√±a">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Confirmar Contrase√±a *</ion-label>
              <ion-input formControlName="confirmPassword" type="password" placeholder="Confirma tu nueva contrase√±a">
              </ion-input>
            </ion-item>

            <div *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched"
              class="error-message">
              <ion-icon name="alert-circle-outline"></ion-icon>
              Las contrase√±as no coinciden
            </div>

            <div class="password-buttons">
              <ion-button expand="block" color="success" (click)="changePassword()" [disabled]="passwordForm.invalid">
                <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
                Actualizar Contrase√±a
              </ion-button>
              <ion-button expand="block" color="medium" fill="outline" (click)="togglePasswordChange()">
                <ion-icon name="close-outline" slot="start"></ion-icon>
                Cancelar
              </ion-button>
            </div>
          </form>
        </ion-card-content>
      </ion-card>

      <!-- Info Card -->
      <ion-card class="info-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="information-circle-outline"></ion-icon>
            Informaci√≥n Importante
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="info-text">
            ‚Ä¢ Solo puedes editar tu propio perfil<br>
            ‚Ä¢ El correo electr√≥nico no puede ser modificado<br>
            ‚Ä¢ La contrase√±a debe tener al menos 6 caracteres<br>
            ‚Ä¢ Los cambios se guardan inmediatamente
          </p>
        </ion-card-content>
      </ion-card>
    </div>
=======
<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Mi Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="main-content">
  <!-- Spinner de carga -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando perfil...</p>
  </div>

  <!-- Contenido del perfil -->
  <div *ngIf="!loading" class="perfil-container">

    <!-- Card principal de perfil -->
    <div class="profile-header-card">
      <div class="profile-avatar">
        {{ getInitials(admin.nombres) }}
      </div>
      <div class="profile-info">
        <h2>{{ admin.nombres }} {{ admin.apellidos }}</h2>
        <p class="profile-email">
          <ion-icon name="mail-outline"></ion-icon>
          {{ admin.email }}
        </p>
        <p class="profile-phone" *ngIf="admin.telefono">
          <ion-icon name="call-outline"></ion-icon>
          {{ admin.telefono }}
        </p>
        <span class="profile-role">{{ admin.rol | uppercase }}</span>
      </div>
    </div>

    <!-- Informaci√≥n Personal Card -->
    <div class="info-card">
      <div class="card-header">
        <h4>üìã Informaci√≥n Personal</h4>
      </div>
      <div class="card-body">
        <div class="info-row">
          <span class="info-label">Registrado:</span>
          <span class="info-value">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ formatDate(admin.created_at) }}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">√öltima actualizaci√≥n:</span>
          <span class="info-value">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ formatDate(admin.updated_at) }}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Estado:</span>
          <span class="info-value badge badge-active">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            Activo
          </span>
        </div>
      </div>
    </div>

    <!-- Informaci√≥n del Sistema Card -->
    <div class="info-card">
      <div class="card-header">
        <h4>üìä Informaci√≥n del Sistema</h4>
      </div>
      <div class="card-body">
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ systemInfo.totalDocentes }}</div>
            <div class="stat-label">Docentes</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ systemInfo.totalEstudiantes }}</div>
            <div class="stat-label">Estudiantes</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ systemInfo.totalAdministradores }}</div>
            <div class="stat-label">Administradores</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seguridad Card -->
    <div class="info-card security-card">
      <div class="card-header">
        <h4>üîê Seguridad</h4>
      </div>
      <div class="card-body">
        <div class="security-item">
          <div class="security-info">
            <span class="security-label">Contrase√±a</span>
            <span class="security-desc">√öltima actualizaci√≥n: Hace 30 d√≠as</span>
          </div>
          <span class="security-badge">Segura</span>
        </div>
        <div class="security-item">
          <div class="security-info">
            <span class="security-label">Sesi√≥n Activa</span>
            <span class="security-desc">{{ systemInfo.ultimoAcceso }}</span>
          </div>
          <span class="security-badge active">En l√≠nea</span>
        </div>
      </div>
    </div>

    <!-- Acciones Card -->
    <div *ngIf="!isEditingProfile && !isChangingPassword" class="action-buttons">
      <ion-button expand="block" (click)="startEditProfile()" class="btn-edit">
        <ion-icon slot="start" name="pencil-outline"></ion-icon>
        Editar Informaci√≥n
      </ion-button>

      <ion-button expand="block" (click)="startChangePassword()" class="btn-password">
        <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
        Cambiar Contrase√±a
      </ion-button>
    </div>

    <!-- Modal backdrop + Edit Section -->
    <div *ngIf="isEditingProfile" class="modal-backdrop">
      <div class="modal-content edit-section">
        <h3>‚úèÔ∏è Editar Informaci√≥n Personal</h3>

        <ion-card class="input-card">
          <ion-card-content>
            <!-- Nombres -->
            <ion-item class="input-item">
              <ion-label>Nombres</ion-label>
              <ion-input
                type="text"
                [(ngModel)]="editForm.nombres"
                placeholder="Ingresa tus nombres">
              </ion-input>
            </ion-item>

            <!-- Apellidos -->
            <ion-item class="input-item">
              <ion-label>Apellidos</ion-label>
              <ion-input
                type="text"
                [(ngModel)]="editForm.apellidos"
                placeholder="Ingresa tus apellidos">
              </ion-input>
            </ion-item>

            <!-- Tel√©fono -->
            <ion-item class="input-item">
              <ion-label>Tel√©fono</ion-label>
              <ion-input
                type="tel"
                [(ngModel)]="editForm.telefono"
                placeholder="Ingresa tu tel√©fono (opcional)">
              </ion-input>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <!-- Botones de acci√≥n -->
        <div class="form-actions">
          <ion-button expand="block" (click)="saveProfileChanges()" [disabled]="loading" class="btn-save">
            <ion-icon slot="start" name="checkmark-outline"></ion-icon>
            Guardar Cambios
          </ion-button>

          <ion-button expand="block" (click)="cancelEditProfile()" fill="outline" class="btn-cancel">
            <ion-icon slot="start" name="close-outline"></ion-icon>
            Cancelar
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Modal backdrop + Password Section -->
    <div *ngIf="isChangingPassword" class="modal-backdrop">
      <div class="modal-content password-section">
        <h3>üîë Cambiar Contrase√±a</h3>

        <ion-card class="input-card">
          <ion-card-content>
            <!-- Contrase√±a Actual -->
            <ion-item class="input-item password-item">
              <ion-label>Contrase√±a Actual</ion-label>
              <ion-input
                [type]="showCurrentPassword ? 'text' : 'password'"
                [(ngModel)]="passwordForm.currentPassword"
                >
              </ion-input>
              <ion-icon
                slot="end"
                [name]="showCurrentPassword ? 'eye-outline' : 'eye-off-outline'"
                (click)="togglePasswordVisibility('current')"
                class="password-toggle">
              </ion-icon>
            </ion-item>

            <!-- Nueva Contrase√±a -->
            <ion-item class="input-item password-item">
              <ion-label>Nueva Contrase√±a</ion-label>
              <ion-input
                [type]="showNewPassword ? 'text' : 'password'"
                [(ngModel)]="passwordForm.newPassword"
                >
              </ion-input>
              <ion-icon
                slot="end"
                [name]="showNewPassword ? 'eye-outline' : 'eye-off-outline'"
                (click)="togglePasswordVisibility('new')"
                class="password-toggle">
              </ion-icon>
            </ion-item>

            <!-- Confirmar Contrase√±a -->
            <ion-item class="input-item password-item">
              <ion-label>Confirmar Contrase√±a</ion-label>
              <ion-input
                [type]="showConfirmPassword ? 'text' : 'password'"
                [(ngModel)]="passwordForm.confirmPassword"
                >
              </ion-input>
              <ion-icon
                slot="end"
                [name]="showConfirmPassword ? 'eye-outline' : 'eye-off-outline'"
                (click)="togglePasswordVisibility('confirm')"
                class="password-toggle">
              </ion-icon>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <div class="password-hint">
          <small>‚ö†Ô∏è M√≠nimo 6 caracteres. Usa may√∫sculas, n√∫meros y s√≠mbolos para mayor seguridad.</small>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="form-actions">
          <ion-button expand="block" (click)="changePassword()" [disabled]="loading" class="btn-save">
            <ion-icon slot="start" name="checkmark-outline"></ion-icon>
            Actualizar Contrase√±a
          </ion-button>

          <ion-button expand="block" (click)="cancelChangePassword()" fill="outline" class="btn-cancel">
            <ion-icon slot="start" name="close-outline"></ion-icon>
            Cancelar
          </ion-button>
        </div>
      </div>
    </div>

>>>>>>> 12b5483e3a772962cb6c43c35c1e4be0fc4d057f
  </div>
</ion-content>