<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <div class="header-content">
      <div class="app-info">
        <ion-title class="app-title">ControlAsist</ion-title>
        <span class="version-badge">v1.0.0</span>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="refresh-outline"
      pullingText="Desliza para actualizar"
      refreshingSpinner="crescent"
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="home-container">
    
    <!-- Perfil del Docente MEJORADO -->
    <div class="profile-section">
      
      <!-- Loading Skeleton del perfil -->
      <ion-card class="profile-card" *ngIf="loadingProfile">
        <ion-card-content>
          <div class="profile-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-info">
              <ion-skeleton-text [animated]="true" style="width: 60%; height: 24px; margin-bottom: 8px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="true" style="width: 80%; height: 16px;"></ion-skeleton-text>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Perfil cargado CON BOTONES -->
      <ion-card class="profile-card" *ngIf="!loadingProfile && docente">
        <ion-card-content>
          <div class="profile-header-wrapper">
            <!-- Información del perfil -->
            <div class="profile-header">
              <ion-avatar class="profile-avatar">
                <img [src]="getAvatarUrl()" [alt]="getNombreCompleto()" />
              </ion-avatar>
              <div class="profile-info">
                <h2 class="profile-name">{{ getNombreCompleto() }}</h2>
                <div class="profile-email">
                  <ion-icon name="mail-outline"></ion-icon>
                  {{ docente.email }}
                </div>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="profile-actions">
              <ion-button 
                (click)="editarPerfil()" 
                fill="solid" 
                color="primary"
                class="action-button edit-button">
                <ion-icon name="create-outline" slot="start"></ion-icon>
                Editar Perfil
              </ion-button>
              <ion-button 
                (click)="logout()" 
                fill="outline" 
                color="danger"
                class="action-button logout-button-header">
                <ion-icon name="log-out-outline" slot="start"></ion-icon>
                Cerrar Sesión
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Sección de Asignaturas -->
    <div class="asignaturas-section">
      
      <!-- Header con filtro -->
      <div class="section-header">
        <h3 class="section-title">
          <ion-icon name="book-outline"></ion-icon>
          Mis Asignaturas
          <ion-badge color="primary" *ngIf="!loadingAsignaturas">{{ asignaturas.length }}</ion-badge>
        </h3>
        <ion-button (click)="crearAsignatura()" size="default" class="add-button">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Nueva
        </ion-button>
      </div>

      <!-- Filtro por Periodo/Año -->
      <div class="filter-section" *ngIf="!loadingAsignaturas && periodos.length > 0">
        <div class="filter-header">
          <ion-icon name="funnel-outline"></ion-icon>
          <span>Filtrar por periodo:</span>
        </div>
        <ion-item lines="none" class="filter-select">
          <ion-select [value]="periodoSeleccionado" (ionChange)="onPeriodoChange($event)" interface="action-sheet"
            placeholder="Selecciona un periodo">
            <ion-select-option value="todos">
              Todos ({{ asignaturas.length }})
            </ion-select-option>
            <ion-select-option *ngFor="let periodo of periodos" [value]="periodo">
              {{ periodo }} ({{ getAsignaturasPorPeriodo(periodo) }})
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <!-- Loading Skeletons -->
      <div class="asignaturas-list" *ngIf="loadingAsignaturas">
        <div class="asignatura-item skeleton-item" *ngFor="let item of [1,2,3]">
          <div class="skeleton-color"></div>
          <div class="skeleton-content">
            <ion-skeleton-text [animated]="true" style="width: 70%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
            <ion-skeleton-text [animated]="true" style="width: 40%; height: 16px; margin-bottom: 8px;"></ion-skeleton-text>
            <ion-skeleton-text [animated]="true" style="width: 90%; height: 14px;"></ion-skeleton-text>
          </div>
        </div>
      </div>

      <!-- Sin asignaturas -->
      <div *ngIf="!loadingAsignaturas && asignaturas.length === 0" class="empty-state">
        <div class="empty-icon-container">
          <ion-icon name="book-outline" class="empty-icon"></ion-icon>
        </div>
        <h4>No tienes asignaturas registradas</h4>
        <p>Crea tu primera asignatura para comenzar a gestionar la asistencia de tus estudiantes</p>
        <ion-button (click)="crearAsignatura()" expand="block" class="empty-button">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Crear mi primera asignatura
        </ion-button>
      </div>

      <!-- Sin asignaturas en el periodo seleccionado -->
      <div *ngIf="!loadingAsignaturas && asignaturas.length > 0 && asignaturasFiltradas.length === 0" class="empty-filter-state">
        <ion-icon name="calendar-outline" class="empty-filter-icon"></ion-icon>
        <h4>No hay asignaturas en {{ periodoSeleccionado }}</h4>
        <p>Selecciona otro periodo o crea una nueva asignatura</p>
      </div>

      <!-- Lista de asignaturas -->
      <div class="asignaturas-list" *ngIf="!loadingAsignaturas && asignaturasFiltradas.length > 0">
        <div 
          *ngFor="let asignatura of asignaturasFiltradas; let i = index"
          class="asignatura-item"
          (click)="verAsignatura(asignatura)"
          [style.animation-delay]="(i * 0.05) + 's'">
          
          <!-- Barra de color -->
          <div class="asignatura-color" [style.background]="asignatura.color"></div>
          
          <!-- Contenido -->
          <div class="asignatura-content">
            <div class="asignatura-main">
              <div class="asignatura-icon" [style.background]="asignatura.color">
                <ion-icon name="book-outline"></ion-icon>
              </div>
              <div class="asignatura-info">
                <h4 class="asignatura-nombre">{{ asignatura.nombre }}</h4>
                <div class="asignatura-meta">
                  <span class="meta-item">
                    <ion-icon name="code-outline"></ion-icon>
                    {{ asignatura.codigo }}
                  </span>
                  <span class="meta-item">
                    <ion-icon name="people-outline"></ion-icon>
                    Grupo {{ asignatura.grupo }}
                  </span>
                  <span class="meta-item">
                    <ion-icon name="school-outline"></ion-icon>
                    Nivel {{ asignatura.nivel }}
                  </span>
                </div>
                <div class="asignatura-badges">
                  <ion-chip class="info-chip" [style.--background]="asignatura.color + '20'" [style.color]="asignatura.color">
                    <ion-icon name="calendar-outline"></ion-icon>
                    <ion-label>{{ asignatura.periodo }}</ion-label>
                  </ion-chip>
                  <ion-chip class="info-chip" color="success" outline="true">
                    <ion-icon name="book-outline"></ion-icon>
                    <ion-label>{{ asignatura.creditos }} créditos</ion-label>
                  </ion-chip>
                  <ion-chip class="info-chip" color="primary" outline="true">
                    <ion-icon name="desktop-outline"></ion-icon>
                    <ion-label>{{ asignatura.modalidad }}</ion-label>
                  </ion-chip>
                </div>
              </div>
            </div>
            <div class="asignatura-arrow">
              <ion-icon name="chevron-forward-outline"></ion-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</ion-content>